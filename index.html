<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script>
        L_PREFER_CANVAS = false;
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
    <meta charset=utf-8 />
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <style>
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            left: 0;
        }
    </style>
</head>

<body>
    <div class="folium-map" id="map"></div>
    <div style=" position: absolute; top: 14px; z-index: 1000; left: 60px; ">
        <input id="base_url" type="text" style="font-size: 16px;" placeholder="Base Url (default: base.maps.api.here.com)" maxlength="100" size="40"> </div>
    <div style=" position: absolute; top: 44px; z-index: 1000; left: 60px; ">
        <input id="tiletypes" type="text" style="font-size: 16px;" placeholder="Type Tyle (default: maptile)" maxlength="100" size="40"> </div>
    <div style=" position: absolute; top: 74; z-index: 1000; left: 60px; ">
        <input id="scheme" type="text" style="font-size: 16px;" placeholder="Tile Scheme (default: normal.day)" maxlength="100" size="40"> </div>
    <div style=" position: absolute; top: 104px; z-index: 1000; left: 60px; ">
        <input id="poi_cat_mask" type="text" style="font-size: 16px;" placeholder="pois (default: blank)" maxlength="100" size="40"> </div>
    <div style=" position: absolute; top: 134px; z-index: 1000; left: 60px; ">
        <input id="lg" type="text" style="font-size: 16px;" placeholder="lg (default: eng)" maxlength="100" size="40"> </div>
    <div style=" position: absolute; top: 164px; z-index: 1000; left: 60px; ">
        <input id="style" type="text" style="font-size: 16px;" placeholder="style (default: default)" maxlength="100" size="40"> </div>
    <div style=" position: absolute; top: 194px; z-index: 1000; left: 60px; ">
        <input id="ppi" type="text" style="font-size: 16px;" placeholder="ppi (default: 72)" maxlength="100" size="40"> </div>
    <div id="full_url" style=" position: absolute; top: 96%; z-index: 1000; left: 60px; "></div>
</body>
<script>
    //Taipei
    var default_lat = 25.03678;
    var default_lon = 121.56851;
    mapper(default_lat, default_lon, 0);

    function mapper(lat, lon, radius) {
        var dt = new Date();
        var epoch = new Date().getTime();
        var sec = dt.getMilliseconds()
        var bounds = null;
        var map = L.map('map', {
            center: [default_lat, default_lon]
            , zoom: 16
            , maxZoom: 20
            , minZoom: 4
            , maxBounds: bounds
            , layers: []
            , worldCopyJump: false
            , crs: L.CRS.EPSG3857
            , keyboard: true
        });
        var he_appid = 'NXqTq9BXXeEiR4yuXfjj';
        var he_appcode = '3NpseRCnS25FaujWRdthVQ';

        function compose_url() {
            var base_url = document.getElementById('base_url').value;
            if (!base_url) {
                base_url = 'base.maps.cit.api.here.com';
            }
            var tiletypes = document.getElementById('tiletypes').value;
            if (!tiletypes) {
                tiletypes = 'maptile';
            }
            var scheme = document.getElementById('scheme').value;
            if (!scheme) {
                scheme = 'normal.day';
            }
            var style = document.getElementById('style').value;
            if (!style) {
                style = 'default';
            }
            var ppi = document.getElementById('ppi').value;
            if (!ppi) {
                ppi = '72';
            }
            var pois = document.getElementById('poi_cat_mask').value;
            if (!pois) {
                pois = '';
            }
            var lg = document.getElementById('lg').value;
            if (!lg) {
                lg = 'eng';
            }
            var tile_base_url = 'https://{s}.' + base_url + '/maptile/2.1/' + tiletypes + '/newest/' + scheme + '/{z}/{x}/{y}/256/png8?ppi=' + ppi + '&app_id=' + he_appid + '&app_code=' + he_appcode + '&style=' + style + '&pois=' + pois + '&lg=' + lg;
            document.getElementById('full_url').innerHTML = '<mark>' + 'https://{s}.' + base_url + '/maptile/2.1/' + tiletypes + '/newest/' + scheme + '/{z}/{x}/{y}/256/png8?ppi=' + ppi + '&app_id={APP_ID}&app_code={APP_CODE}&style=' + style + '&lg=' + lg + '&pois=' + pois + '</mark>';
            return tile_base_url
        }
        document.getElementById('base_url').addEventListener('keypress', onSearch);
        document.getElementById('tiletypes').addEventListener('keypress', onSearch);
        document.getElementById('scheme').addEventListener('keypress', onSearch);
        document.getElementById('style').addEventListener('keypress', onSearch);
        document.getElementById('ppi').addEventListener('keypress', onSearch);
        document.getElementById('lg').addEventListener('keypress', onSearch);
        document.getElementById('poi_cat_mask').addEventListener('keypress', onSearch);
        var tile_base_url = compose_url();
        var layer = L.tileLayer(tile_base_url, {
            "attribution": "HERE"
            , "detectRetina": true
            , "maxZoom": 20
            , "minZoom": 1
            , "noWrap": false
            , "subdomains": ['1', '2', '3', '4']
        }).addTo(map);
        map.addLayer(layer);

        function onSearch(e) {
            var keyCode = null;
            if (e.which) {
                keyCode = e.which;
            }
            else if (e.keyCode) {
                keyCode = e.keyCode;
            }
            if (keyCode == 13) {
                map.removeLayer(layer);
                var lg = document.getElementById('lg').value;
                var poi_mask_value = document.getElementById('poi_cat_mask').value;
                var tile_base_url = compose_url();
                layer.setUrl(tile_base_url);
                map.addLayer(layer);
            }
        }
        L.control.scale({
            position: 'bottomright'
        }).addTo(map);
    };
</script>